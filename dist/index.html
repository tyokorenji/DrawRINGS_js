<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset = "utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Draw RINGS</title>
    <!-- BootstrapのCSS読み込み -->
    <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery読み込み -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- BootstrapのJS読み込み -->
    <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../bower_components/EaselJS/lib/easeljs-0.8.2.min.js"></script>
    <script src="../bower_components/responsive-bootstrap-toolkit/dist/bootstrap-toolkit.min.js"></script>

    <!--Jquery UIの読み込み-->
    <link rel="stylesheet" href="../bower_components/jquery-ui/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <style>
        body{
            /*text-align: center;*/
            /*width: 1200px;*/
            margin: 0px 25px auto 25px;
        }

        h1{
            text-align: left;
            font-size: 40px;
            font-family:Arial, sans-serif;
            font-weight: bold;
        }

        #canvas,#kcf_format{
            border:1px solid gray;
        }

        .upper-menu {
            margin-bottom: 50px;
        }

        .lower-menu {
            height: 100px;
            position:absolute;
            bottom:0px;
        }

        .lower-menu-sm {
            height: 100px;
            margin-top: 25px;
        }

        .draw-area {
            width: 100%;
            height: auto;
            max-height: 570px;
        }

        .form-control {
            min-height: 100%;
        }

        #KCFForm {
            min-height: 100%;
        }

        .hidden-menu {
            display: none !important;
            visibility: hidden !important;
        }

        .visible-menu {
            display: block !important;
            visibility: visible !important;
        }

    </style>

</head>

<body>
<h1 class="page-header">DrawRINGS</h1>

<!-- 各ツールの設定 -->
<div class="row upper-menu">

    <!--<div class="btn-group col-md-4">-->
    <!--<button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" type="button" >Edit canvas <span class="caret"></span></button>-->
    <!--<ul class="dropdown-menu  nav nav-pills nav-stacked" role="menu">-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="select" style="width:150px;" onclick="edits(1)">Select </button></li>-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="node" style="width:150px;" onclick="edits(2)">Node </button></li>-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="edge" style="width:150px;" onclick="edits(3)">Edge </button></li>-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="structure" style="width:150px;" onclick="edits(4)">Structure </button></li>-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="clearall" style="width:150px;" onclick="edits(5)">Clear All </button></li>-->
    <!--<li><button class="btn btn-success"  name="mode" data-value="erasenode" style="width:150px;" onclick="edits(6)">Erase Node </button></li>-->
    <!--<li><button class="btn btn-success" name="mode" data-value="monenode" style="width:150px;" onclick="edits(7)">Move Node </button></li>-->
    <!--</ul>-->
    <!--<input type="hidden" name="dropdown-value" value="">-->
    <!--</div>-->

    <div class="btn-group col-md-6">
        <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" type="button" >File management <span class="caret"></span></button>
        <ul class="dropdown-menu nav nav-pills nav-stacked" role="menu">
            <li><input type="button" class="btn btn-success" name="File" value="Upload File" style="width:150px;" onclick="$('#kcfFileLoad').click();"></li>
            <li><button class="btn btn-success" name="File" value="drawkcf" style="width:150px;" onclick="DrawKCF()" >Draw KCF </button></li>
            <li><button class="btn btn-success" name="File" value="kcftextout" style="width:150px;"onclick="edits(8)">KCF Text out </button></li>
            <li><button class="btn btn-success" name="File" value="textclear" style="width:150px;" onclick="textClear()">Text clear </button></li>
        </ul>
    </div>

    <div class="btn-group col-md-6">
        <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" type="button" >Run Query <span class="caret"></span></button>
        <ul class="dropdown-menu nav nav-pills nav-stacked" role="menu">
            <li><button class="btn btn-success" name="File" value="runquery" style="width:150px;" id="runQueryButton">Run Query </button></li>
        </ul>
    </div>

</div>

<div class="row">
    <div class="col-xs-12 col-md-2">
        <ul class="nav nav-pills nav-stacked" role="menu">
            <div class="col-xs-12 col-md-12">
                <div class="col-xs-3 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="select" style="width:150px;" onclick="edits(1)">Select </button></li>
                </div>
                <div class="col-xs-3 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="node" style="width:150px;" onclick="edits(2)">Node </button></li>
                </div>
                <div class="col-xs-3 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="edge" style="width:150px;" onclick="edits(3)">Edge </button></li>
                </div>
                <div class="col-xs-3 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="structure" style="width:150px;" onclick="edits(4)">Structure </button></li>
                </div>
            </div>
            <div class="col-xs-12 col-md-12">
                <div class="col-xs-4 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="clearall" style="width:150px;" onclick="edits(5)">Clear All </button></li>
                </div>
                <div class="col-xs-4 col-md-12">
                    <li><button class="btn btn-success"  name="mode" data-value="erasenode" style="width:150px;" onclick="edits(6)">Erase Node </button></li>
                </div>
                <div class="col-xs-4 col-md-12">
                    <li><button class="btn btn-success" name="mode" data-value="movenode" style="width:150px;" onclick="edits(7)">Move Node </button></li>
                </div>
            </div>
        </ul>
    </div>
    <div class="col-xs-12 col-md-6" id="canvasContainer">
        <canvas id ="canvas" class="draw-area" width="300px" height="300px" >このブラウザはHTML5に対応していません。</canvas>
    </div>
    <div class="col-xs-12 col-md-4" >
        <form name="KCFform" id="KCFForm" action="">
            <textarea class="form-control" id="kcf_format">KCF-Text</textarea>
        </form>
    </div>
</div>


<div id="footer" class="row lower-menu">
    <div id="nodeMenu">
        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Hexose</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-righ" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(101)">Hexose </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(102)">Glc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(103)">Man </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(104)">Gal </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(105)">Gul </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(106)">Alt </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(107)">All </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(108)">Tal </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(109)">Ido </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">HexNAc</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(201)">HexNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(202)">GlcNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(203)">ManNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(204)">GalNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(205)">GulNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(206)">AltNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(207)">AllNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(208)">TalNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(209)">IdoNAc </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Hexosamine</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(301)">Hexosamine </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(302)">GlcN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(303)">ManN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(304)">GalN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(305)">GulN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(306)">AltN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(307)">AllN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(308)">TalN </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(309)">IdoN </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Hexuronate</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeButton(401)">Hexuronate</button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(402)">GlcA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(403)">ManA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(404)">GalA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(405)">GulA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(406)">AltA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(407)">AllA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(408)">TalA </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(409)">IdoA </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Deoxyhexose</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(501)">Deoxyhexose </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(502)">Qui </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(503)">Rha </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(504)">6dAlt </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(505)">6dTal </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(506)">Fuc </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">DeoxyhexNAc</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(601)">DeoxyhexNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(602)">QuiNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(603)">RhaNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(604)">FucNAc </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Di-deoxyhexose</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(701)">Di-deoxyhexose </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(702)">Oli </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(703)">Tyv </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(704)">Abe </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(705)">Par </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(706)">Dig </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(707)">Col </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Pentose</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(801)">Pentose </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(802)">Ara </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(803)">Lyx </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(804)">Xyl </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(805)">Rib </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Nonulosonate</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(901)">Nonulosonate </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(902)">Kdn </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(903)">Neu5Ac </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(904)">Neu5Gc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(905)">Neu </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Unknown</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1001)">Unknown </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1002)">Bac </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1003)">LDManHep </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1004)">Kdo </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1005)">Dha </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1006)">DDManHep </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1007)">MurNAc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1008)">MurNGc </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1009)">Mur </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Assigned</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1101)">Assigned </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1102)">Api </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1103)">Fru </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1104)">Tag </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1105)">Sor </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="nodeMenu(1106)">Psi </button></li>
            </ul>
        </div>
    </div>


    <div id="edgeMenu">
        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">α1-</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-righ" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a1-2')">α1-2 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a1-3')">α1-3 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a1-4')">α1-4 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a1-6')">α1-6 </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">β1-</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('b1-2')">β1-2 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('b1-3')">β1-3 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('b1-4')">β1-4 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('b1-6')">β1-6 </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">α2-</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a2-3')">α2-3 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a2-6')">α2-6 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="edgeMenu('a2-8')">α2-8 </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">other</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li>
                    <form name="edgeForm" id="edgeForm" action="">
                        <input class="btn btn-success" type="text" name="edge"  id="edgeText" style="width:150px;" value=""/>
                        <input class="btn btn-success" type="button" value="Exec" style="width:150px;" onclick="edgeTextMenu();"/>
                    </form>
                </li>
            </ul>
        </div>
    </div>

    <div id="structureMenu">
        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">N-glycan</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-righ" role="menu">
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('N-glycan_core')">N-glycan_core </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('N-glycan_fucosylated_core')">N-glycan_fucosylated_core </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('N-glycan_bisecting_core')">N-glycan_bisecting_core </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('N-glycan_bisecting_fucosylated_core')">N-glycan_bisecting_fucosylated_core </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('hight-mannose')">hight-mannose </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('hybrid')">hybrid </button></li>
                <li><button class="btn btn-success" style="width:260px;" onclick="strucureMenu('complex')">complex </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">O-glycan</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_1')">O-glycan_core_1 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_2')">O-glycan_core_2 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_3')">O-glycan_core_3 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_4')">O-glycan_core_4 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_5')">O-glycan_core_5 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_6')">O-glycan_core_6 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_7')">O-glycan_core_7 </button></li>
                <li><button class="btn btn-success" style="width:150px;" onclick="strucureMenu('O-glycan_core_8')">O-glycan_core_8 </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Glycosphingolipids</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_arthro_type')">GSL_core_arthro_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_gala_type')">GSL_core_gala_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_ganglio_type')">GSL_core_ganglio_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_globo_type')">GSL_core_globo_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_isoglobo_type')">GSL_core_isoglobo_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_lact_type')">GSL_core_lact_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_mollu_type')">GSL_core_mollu_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_muco_type')">GSL_core_muco_type </button></li>
                <li><button class="btn btn-success" style="width:200px;" onclick="strucureMenu('GSL_core_neolacto_type')">GSL_core_neolacto_type </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">GAGs</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Hyaluronic_Acid')">Hyaluronic_Acid </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('chondroitin_4_sulfate')">chondroitin_4_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('chondroitin_6_sulfate')">chondroitin_6_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('chondroitin_2,6_sulfate')">chondroitin_2,6_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('chondroitin_4,6_sulfate')">chondroitin_4,6_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Dermatan_sulfate')">Dermatan_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Karatan_sulfate')">Karatan_sulfate </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Heparin')">Heparin </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Heparansan_sulfate')">Heparansan_sulfate </button></li>
            </ul>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" style="width:150px;">Motifs</button>
            <button class="btn btn-success dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-triangle-right"></span></button>
            <ul class="dropdown-menu test-menu pull-right" role="menu">
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('3\'sulfo_Lewis_X')">3'sulfo_Lewis_X </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Blood_Group_A_Antigen')">Blood_Group_A_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Blood_Group_B_Antigen')">Blood_Group_B_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Blood_Group_X_Antigen')">Blood_Group_X_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Cad_Antigen')">Cad_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GD1a')">GD1a </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GD1b')">GD1b </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GD2')">GD2 </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GD3')">GD3 </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GM1a')">GM1a </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GM1b')">GM1b </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GM2')">GM2 </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('GM3')">GM3 </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('LacDiNAc')">LacDiNAc </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lactosamin')">Lactosamin </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_A')">Lewis_A </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_B')">Lewis_B </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_C')">Lewis_C </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_D')">Lewis_D </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_X')">Lewis_X </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Lewis_Y')">Lewis_Y </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('P_Antigen')">P_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Pk_Antigen')">Pk_Antigen </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Poly_Lactosamine')">Poly_Lactosamine </button></li>
                <li><button class="btn btn-success" style="width:180px;" onclick="strucureMenu('Sialy_Lewis_A')">Sialy_Lewis_A </button></li>
                <li><button class="btn btn-success" style="..." onclick="strucureMenu('Sialy_Lewis_X')">Sialy_Lewis_X </button></li>
            </ul>
        </div>
    </div>
</div>

<div id="runQueryDialogBox" title="Run Query">
    <!--チェックボックスを配置-->
    <label><p>Score matrix</p>
        <form name="scoreMatrix">
            <SELECT name="scoreSelect">
                <OPTION value="none" selected>none</OPTION>
                <OPTION value="N-Glycan">N-glycan</OPTION>
                <OPTION value="O-glycan">O-glycan</OPTION>
                <OPTION value="Sphingolipid">Sphingolipid</OPTION>
                <OPTION value="Link_similarity">Link_similarity</OPTION>
            </SELECT>
        </form>
    </label>
    <label><p>Database</p>
        <form name="database">
            <SELECT name="databaseSelect">
                <<OPTION value="All" selected>All</OPTION>
                <OPTION value="GlycomeDB">GlycomeDB</OPTION>
                <OPTION value="RINGS">RINGS</OPTION>
            </SELECT>
        </form>
    </label>
    <label><p></p></label>
    <form name="kindRnuQueryResult">
        <label><input type="radio" name="type" value="0" checked> Similarity</label><br />
        <label><input type="radio" name="type" value="1"> Matched</label><br />
    </form>
</div>
<span id="fileArea">
      <input type="file" id="kcfFileLoad" style="display:none;" >
    </span>

<!-- Script -->
<script>



    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d")
    var stage = new createjs.Stage(canvas);
    var nodeHash = {
        101: "hexose",
        102: "glc",
        103: "man",
        104: "gal",
        105: "gul",
        106: "alt",
        107: "all",
        108: "tal",
        109: "ido",
        201: "hexnac",
        202: "glcnac",
        203: "mannac",
        204: "galnac",
        205: "gulnac",
        206: "altnac",
        207: "allnac",
        208: "talnac",
        209: "idonac",
        301: "hexosamine",
        302: "glcn",
        303: "mann",
        304: "galn",
        305: "guln",
        306: "altn",
        307: "alln",
        308: "taln",
        309: "idon",
        401: "hexuronate",
        402: "glca",
        403: "mana",
        404: "gala",
        405: "gula",
        406: "alta",
        407: "alla",
        408: "tala",
        409: "idoa",
        501: "deoxyhexose",
        502: "qui",
        503: "rha",
        504: "6dalt",
        505: "6dtal",
        506: "fuc",
        601: "deoxyhexnac",
        602: "quinac",
        603: "rhanac",
        604: "fucnac",
        701: "di_deoxyhexose",
        702: "oli",
        703: "tyv",
        704: "abe",
        705: "par",
        706: "dig",
        707: "col",
        801: "pentose",
        802: "ara",
        803: "lyx",
        804: "xyl",
        805: "rib",
        901: "noulosonate",
        902: "kdn",
        903: "neu5ac",
        904: "neu5gc",
        905: "neu",
        1001: "unknown",
        1002: "bac",
        1003: "ldmanhep",
        1004: "kdo",
        1005: "dha",
        1006: "ddmanhep",
        1007: "murnac",
        1008: "murngc",
        1009: "mur",
        1101: "assigned",
        1102: "api",
        1103: "fru",
        1104: "tag",
        1105: "sor",
        1106: "psi",
    };

    var structureKey = 0;
    var structures = new Array();

    // リサイズイベントを検知してリサイズ処理を実行
    window.addEventListener("resize", handleResize);
    handleResize(); // 起動時にもリサイズしておく

    // リサイズ処理
    function handleResize(event) {
        // 画面幅・高さを取得
        var canvas = $('#canvas');
        var w = parseInt(canvas.css('width'), 10);
        var h = parseInt(canvas.css('height'), 10);

        // Canvas要素の大きさを画面幅・高さに合わせる
        stage.canvas.width = w;
        stage.canvas.height = h;

        // 画面更新する
        stage.update();
        Range();
    }

    (function($){
        var viewport = ResponsiveBootstrapToolkit;
        // Execute only after document has fully loaded
        $(document).ready(function () {
            changeFooterStyle();
            setTextareaSize();
        });

        // Execute code each time window size changes
        $(window).resize(
                viewport.changed(function () {
                    changeFooterStyle();
                    setTextareaSize();
                })
        );

//        var kcfFormat = document.getElementById("kcfFileLoad");
//        kcfFormat.addEventListener("change", kcfTextFile(event));

    })(jQuery);

    function changeFooterStyle() {
        var viewport = ResponsiveBootstrapToolkit;

        // Executes only in XS breakpoint
        if( viewport.is('<=sm') ) {
            $('#footer').removeClass('lower-menu');
            $('#footer').addClass('lower-menu-sm');
        } else {
            $('#footer').removeClass('lower-menu-sm');
            $('#footer').addClass('lower-menu');
        }

        /*
         if( viewport.is('xs') ) {
         // ...
         }
         // Executes in SM, MD and LG breakpoints
         if( viewport.is('>=sm') ) {
         // ...
         }

         // Executes in XS and SM breakpoints
         if( viewport.is('<md') ) {
         // ...
         }
         */
    }

    function setTextareaSize() {
        var canvas = $('#canvas');
        var w = parseInt(canvas.css('width'), 10);
        var h = parseInt(canvas.css('height'), 10);

        var textarea = $('#kcf_format');
        //textarea.css('width', w);
        textarea.css('height', h);
    }

    jQuery(function($){
        $("#runQueryDialogBox").dialog({
            autoOpen: false,  // 自動的に開かないように設定
            width: 400,       // 横幅のサイズを設定
            modal: true,      // モーダルダイアログにする
            buttons: [        // ボタン名 : 処理 を設定
                {
                    text: 'OK',
                    click: function(){
                        edits(9);
                    }
                },
                {
                    text: 'Cancel',
                    click: function(){
                        $(this).dialog("close");
                    }
                }
            ]
        });
        $("#runQueryButton").click(function(){
            $("#runQueryDialogBox").dialog("open");
        });
    })


    var Structure = function Structure(structureId,Node1, Node2, edgeInformamtion) {
        this.structureId = structureId;
        this.Node1 = Node1;
        this.Node2 = Node2;
        this.edgeInformamtion = edgeInformamtion;
        this.edge = null;
    }

    var Node = function Node(nodeId, nodeName) {
        this.Shape_constructor();
        this.param = {
            id: nodeId,
            monosaccharide: nodeName,
            sortParamX: 0,
            sortParamY: 0,
        };
    }
    createjs.extend(Node, createjs.Shape);
    createjs.promote(Node, "Shape");

    var kindNode = {
        color : function(){
            if(nodeHash[nodeHashKey] === "hexose" || nodeHash[nodeHashKey] === "hexnac" || nodeHash[nodeHashKey]=== "hexosamine" || nodeHash[nodeHashKey] === "hexuronate" || nodeHash[nodeHashKey] === "deoxyhexose" || nodeHash[nodeHashKey] === "deoxyhexnac" || nodeHash[nodeHashKey] === "di_deoxyhexose" || nodeHash[nodeHashKey] === "pentose" || nodeHash[nodeHashKey] === "nonuloosonate" || nodeHash[nodeHashKey] === "unknown" || nodeHash[nodeHashKey] === "assigned") {return 'rgb(250, 250, 250)';}
            else if(nodeHash[nodeHashKey] === "glc" || nodeHash[nodeHashKey] === "glcnac" ||  nodeHash[nodeHashKey] === "glcn" || nodeHash[nodeHashKey] === "glca" || nodeHash[nodeHashKey] === "qui" || nodeHash[nodeHashKey] === "quinac" || nodeHash[nodeHashKey] === "oli" || nodeHash[nodeHashKey] === "bac" || nodeHash[nodeHashKey] === "api") {return 'rgb(0, 128, 255)';}
            else if(nodeHash[nodeHashKey] === "man" || nodeHash[nodeHashKey] === "mannac" ||  nodeHash[nodeHashKey] === "mann" || nodeHash[nodeHashKey] === "mana" || nodeHash[nodeHashKey] === "rha" || nodeHash[nodeHashKey] === "rhanac" || nodeHash[nodeHashKey] === "tyv" || nodeHash[nodeHashKey] === "ara" || nodeHash[nodeHashKey] === "kdn" || nodeHash[nodeHashKey] === "ldmanhep" || nodeHash[nodeHashKey] === "fru") {return 'rgb(0, 255, 0)';}
            else if(nodeHash[nodeHashKey] === "gal" || nodeHash[nodeHashKey] === "galnac" ||  nodeHash[nodeHashKey] === "galn" || nodeHash[nodeHashKey] === "gala" || nodeHash[nodeHashKey] === "lyx" || nodeHash[nodeHashKey] === "kdo" || nodeHash[nodeHashKey] === "tag") {return 'rgb(255, 217, 0)';}
            else if(nodeHash[nodeHashKey] === "gul" || nodeHash[nodeHashKey] === "gulnac" ||  nodeHash[nodeHashKey] === "guln" || nodeHash[nodeHashKey] === "gula" || nodeHash[nodeHashKey] === "abe" || nodeHash[nodeHashKey] === "xyl" || nodeHash[nodeHashKey] === "dha" || nodeHash[nodeHashKey] === "sor") {return 'rgb(255, 128, 0)';}
            else if(nodeHash[nodeHashKey] === "alt" || nodeHash[nodeHashKey] === "altnac" ||  nodeHash[nodeHashKey] === "altn" || nodeHash[nodeHashKey] === "alta" || nodeHash[nodeHashKey] === "6dalt" || nodeHash[nodeHashKey] === "par" || nodeHash[nodeHashKey] === "rib" || nodeHash[nodeHashKey] === "ddmanhep" || nodeHash[nodeHashKey] === "psi") {return 'rgb(255, 136, 194)';}
            else if(nodeHash[nodeHashKey] === "all" || nodeHash[nodeHashKey] === "allnac" ||  nodeHash[nodeHashKey] === "alln" || nodeHash[nodeHashKey] === "alla" || nodeHash[nodeHashKey] === "dig" || nodeHash[nodeHashKey] === "neu5ac" || nodeHash[nodeHashKey] === "murnac") {return 'rgb(159, 31, 255)';}
            else if(nodeHash[nodeHashKey] === "tal" || nodeHash[nodeHashKey] === "talnac" ||  nodeHash[nodeHashKey] === "taln" || nodeHash[nodeHashKey] === "tala" || nodeHash[nodeHashKey] === "6dtal" || nodeHash[nodeHashKey] === "col" || nodeHash[nodeHashKey] === "neu5gc" || nodeHash[nodeHashKey] === "murngc") {return 'rgb(151, 243, 248)';}
            else if(nodeHash[nodeHashKey] === "ido" || nodeHash[nodeHashKey] === "idonac" ||  nodeHash[nodeHashKey] === "idon" || nodeHash[nodeHashKey] === "idoa" || nodeHash[nodeHashKey] === "neu" || nodeHash[nodeHashKey] === "mur") {return 'rgb(140, 116, 54)';}
            else if(nodeHash[nodeHashKey] === "fuc" || nodeHash[nodeHashKey] === "fucnac") {return 'rgb(255, 0, 0)';}

        },

        draw : function (x,y){
            if(100 < nodeHashKey && nodeHashKey < 110){
                var shape= new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                r = 10;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.drawCircle(0, 0, r);
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
                return shape;
            }
            else if(200 < nodeHashKey && nodeHashKey < 210){
                var shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.drawRect(-10, -10, 20, 20);
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
                return shape;
            }
            else if(300 < nodeHashKey && nodeHashKey < 310){
                var shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0-10, 0-10);
                shape.graphics.lineTo(0+10, 0-10);
                shape.graphics.lineTo(0+10, 0+10);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill("rgb(255, 255, 255)");
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0-10, 0-10);
                shape.graphics.lineTo(0-10, 0+10);
                shape.graphics.lineTo(0+10, 0+10);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(400 < nodeHashKey && nodeHashKey < 410){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                if(nodeHash[nodeHashKey] === "alta" || nodeHash[nodeHashKey] === "idoa") shape.graphics.beginFill("rgb( 255, 255, 255)");
                else shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0-10, 0);
                shape.graphics.lineTo(0, 0-10);
                shape.graphics.lineTo(0+10, 0);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                if(nodeHash[nodeHashKey] === "alta" || nodeHash[nodeHashKey] === "idoa") shape.graphics.beginFill(kindNode.color());
                else shape.graphics.beginFill("rgb(255, 255, 255)");
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0-10, 0);
                shape.graphics.lineTo(0, 0+10);
                shape.graphics.lineTo(0+10, 0);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(500 < nodeHashKey && nodeHashKey < 510){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0, 0+10);
                shape.graphics.lineTo(0+10, 0+10);
                shape.graphics.lineTo(0, 0-20);
                shape.graphics.lineTo(0-10, 0+10);
                shape.graphics.lineTo(0, 0+10);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(600 < nodeHashKey && nodeHashKey < 610){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0, 0-10);
                shape.graphics.lineTo(0+10, 0+10);
                shape.graphics.lineTo(0, 0+10);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill("rgb( 255, 255, 255)");
                shape.graphics.moveTo(0, 0);
                shape.graphics.lineTo(0, 0-10);
                shape.graphics.lineTo(0-10, 0+10);
                shape.graphics.lineTo(0, 0+10);
                shape.graphics.lineTo(0, 0);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(700 < nodeHashKey && nodeHashKey < 710){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.drawRect(0-10, 0-10, 20, 10);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(800 < nodeHashKey && nodeHashKey < 810){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.drawPolyStar(0, 0, 10, 5, 0.6, -90);
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(900 < nodeHashKey && nodeHashKey < 910){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0, 0-10);
                shape.graphics.lineTo(0-10, 0);
                shape.graphics.lineTo(0, 0+10);
                shape.graphics.lineTo(0+10, 0);
                shape.graphics.lineTo(0, 0-10);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(1000 < nodeHashKey && nodeHashKey < 1010){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.moveTo(0-8, 0-8);
                shape.graphics.lineTo(0-10, 0);
                shape.graphics.lineTo(0-8, 0+8);
                shape.graphics.lineTo(0+8, 0+8);
                shape.graphics.lineTo(0+10, 0);
                shape.graphics.lineTo(0+8, 0-8);
                shape.graphics.lineTo(0-8, 0-8);
                shape.graphics.endFill();
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
            else if(1100 < nodeHashKey && nodeHashKey < 1110){
                shape = new Node(node_id, nodeHash[nodeHashKey]);
                node_id++;
                shape.graphics.beginStroke("rgb(0, 0, 0)");
                shape.graphics.beginFill(kindNode.color());
                shape.graphics.drawPolyStar(0, 0, 10, 5, 0, -90);
                shape.x = x;
                shape.y = y;
                shape.addEventListener("mousedown", handleDown);
                stage.addChild(shape);
                stage.update();
                nodes[nodeKey] = shape;
                nodeKey++;
            }
        }
    };




    var mouseX = 0;
    var mouseY = 0;
    var mouseX1 = 0;
    var mouseY1 = 0;

    // どの機能かの判別
    var flag = 0;
    var mode = 0;
    var edit = 0;
    var node_id = 1;
    var structure_id = 1;

    var nodeHashKey;
    var edgeKey;
    var nodes = new Array();
    var nodeKey = 0;

    // 機能のための変数
    var dragPointX;
    var dragPointY;
    var startX;
    var startY;
    var edgeCount = 0;
    var edgeStart;
    var targetMoveNode1 = new Array();
    var targetMoveKey1 = 0;
    var targetMoveNode2 = new Array();
    var targetMoveKey2 = 0;
    var selectX = 0;
    var selectY = 0;
    var selectRange = null;
    var moveStructureNodes = new Array();
    var moveStructuresNodesKey = 0;
    var drawStructureXPoints = new Array();
    var drawStructureYPoints = new Array();
    var targetMoveStructureNode1 = new Array();
    var targetMoveStructureNode2 = new Array();
    var targetMoveStructureKey1 = 0;
    var targetMoveStructureKey2 = 0;


    //KCFTextOut
    var usedStructures = new Array;
    var usedStructureKey = 0;
    var KCFTextOutId = 1;
    var glycoTrees = new Array();
    var glycoTreeKey = 0;
    var GlycoTree = function GlycoTree(){
        this.link = null;
        this.children = new Array();
        this.id = null;
        this.Node = null
        this.parentId = null;
    }
    var TAB = "    ";
    var NEW_LINE = "\n";
    var COLON = ":";
    var SLASH = "///";
    var URL_TAB = "%20";
    var URL_NEW_LINE = "%30";
    var WAVE = "~";


    var fileLoadId = document.getElementById("kcfFileLoad");
    var fileLoadTextareaId = document.getElementById("kcf_format");


    fileLoadId.addEventListener("change", function(evt){
        var file = evt.target.files;
        var fileReader = new FileReader();
        fileReader.readAsText(file[0]);
        fileReader.onload = function(evt){
            fileLoadTextareaId.value = fileReader.result;
        };
        $("#kcfFileLoad").val("");
    }, false);


    function nodeMenu(k){
        nodeHashKey = k;
    }
    function edgeMenu(k){
        edgeKey = k;
    }
    function edgeTextMenu(){
        if(!document.edgeForm.edgeText.value.match(/[ab][1-6][-][1-6]/g)){
            alert("Please write \nAnomer(a or b)" + 1 + "~" +6 + ' - ' + 1 + "~" + 6 + "\n example: a1-4");
        }
        else{
            edgeMenu(document.edgeForm.edgeText.value);
        }
    }
    function strucureMenu(k){
        kindStrucure = k;
    }
    function clearAll(){
        var res = confirm("clear ALL?");
        if(res === true){
            for(var i = 0; i < structures.length; i++){
                stage.removeChild(structures[i].edge);
                stage.removeChild(structures[i].edgeInformamtion);
            }
            for(i = 0; i < nodes.length; i++){
                stage.removeChild(nodes[i]);
            }
            stage.update();
            structures.splice( 0, structures.length );
            nodes.splice(0, nodes.length);
            structure_id = 1;
            structureKey = 0;
            node_id = 0;
            nodeKey = 0;
        }
    }

    $(function(){
        $(".dropdown-menu li button").click(function(){
            $(this).parents('.btn-group').find('.dropdown-toggle').html($(this).text() + '<span class="caret"></span>');
            $(this).parents('.btn-group').find('input[name="dropdown-value"]').val($(this).attr("data-value"));
        });
    });


    $('#nodeMenu').addClass('hidden-menu');
    $('#edgeMenu').addClass('hidden-menu');
    $('#structureMenu').addClass('hidden-menu');
    /*
     document.getElementById("nodemenu").style.visibility = "hidden";
     document.getElementById("edgeMenu").style.visibility = "hidden";
     document.getElementById("strucureMenu").style.visibility = "hidden";
     */

    function edits(edit){
        mode = edit;
        if(mode === 2){
            //document.getElementById("nodemenu").style.visibility = "visible";
            $('#nodeMenu').removeClass('hidden-menu');
        }
        else{
            //document.getElementById("nodemenu").style.visibility = "hidden";
            $('#nodeMenu').addClass('hidden-menu');
        }
        if(mode === 3){
            //document.getElementById("edgeMenu").style.visibility = "visible";
            $('#edgeMenu').removeClass('hidden-menu');
        }
        else{
            //document.getElementById("edgeMenu").style.visibility = "hidden";
            $('#edgeMenu').addClass('hidden-menu');
        }
        if(mode === 4){
            //document.getElementById("strucureMenu").style.visibility = "visible";
            $('#structureMenu').removeClass('hidden-menu');
        }
        else{
            //document.getElementById("strucureMenu").style.visibility = "hidden";
            $('#structureMenu').addClass('hidden-menu');
        }
        if(mode === 5){
            clearAll();
        }
        if(mode === 8 || mode === 9){
            CreateTree();
        }
    };

    window.addEventListener("mousedown",WindowClick);
    function WindowClick() {
        if (moveStructureNodes[0] != null) {
            for (var i = 0; i < moveStructureNodes.length; i++) {
                moveStructureNodes[i].graphics._stroke.style = "rgb(0, 0, 0)";
                moveStructureNodes[i].alpha = 1.0;
            }
            moveStructureNodes.splice(0, moveStructureNodes.length);
            moveStructuresNodesKey = 0;
        }
    }

    //Node
    canvas.addEventListener("mousedown", canvasMouseDown);
    function canvasMouseDown(e){
        if(mode != 1 && mode != 2 && mode != 4) return;
        if(mode === 1){
            XY(e);
            selectX = mouseX;
            selectY = mouseY;

            canvas.addEventListener("mousemove", SelectMove);
            canvas.addEventListener("mouseup", SelectUp);

        }
        else if(mode === 2){
            XY(e);
            kindNode.draw(mouseX, mouseY);
        }
        else if(mode === 4){
            if(mode != 4) return;
            if(kindStrucure === "N-glycan_core"){
                nodeHashKey = 103;
                XY(e);
                var man1 = kindNode.draw(mouseX, mouseY);
                var man2 = kindNode.draw(mouseX-100, mouseY-50);
                var man3 = kindNode.draw(mouseX-100, mouseY+50);
                nodeHashKey = 202;
                var glcnac1 = kindNode.draw(mouseX+100, mouseY);
                var glcnac2 = kindNode.draw(mouseX+200, mouseY);
                var structure = new Structure(structure_id, man1, man2, null);
                var line = new createjs.Shape();
                line.graphics.setStrokeStyle(3);
                line.graphics.beginStroke("#000");
                line.graphics.moveTo(man1.x, man1.y);
                line.graphics.lineTo(man2.x, man2.y);
                stage.addChild(line);
                structure.edge = line;
                var edgeText = new createjs.Text("a1-6","12px serif", "rgb(255,0,0)");
                edgeText.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x)/2;
                edgeText.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y)/2;
                stage.addChild(edgeText);
                structure.edgeInformamtion = edgeText;
                structures[structureKey] = structure;
                structureKey++;
                structure_id++;
                var structure = new Structure(structure_id, man1, man3, null);
                var line = new createjs.Shape();
                line.graphics.setStrokeStyle(3);
                line.graphics.beginStroke("#000");
                line.graphics.moveTo(man1.x, man1.y);
                line.graphics.lineTo(man3.x, man3.y);
                stage.addChild(line);
                structure.edge = line;
                var edgeText = new createjs.Text("a1-3","12px serif", "rgb(255,0,0)");
                edgeText.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x)/2;
                edgeText.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y)/2;
                stage.addChild(edgeText);
                structure.edgeInformamtion = edgeText;
                structures[structureKey] = structure;
                structureKey++;
                structure_id++;
                var structure = new Structure(structure_id, man1, glcnac1, null);
                var line = new createjs.Shape();
                line.graphics.setStrokeStyle(3);
                line.graphics.beginStroke("#000");
                line.graphics.moveTo(man1.x, man1.y);
                line.graphics.lineTo(glcnac1.x, glcnac1.y);
                stage.addChild(line);
                structure.edge = line;
                var edgeText = new createjs.Text("b1-4","12px serif", "rgb(255,0,0)");
                edgeText.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x)/2;
                edgeText.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y)/2;
                stage.addChild(edgeText);
                structure.edgeInformamtion = edgeText;
                structures[structureKey] = structure;
                structureKey++;
                structure_id++;
                var structure = new Structure(structure_id, glcnac1, glcnac2, null);
                var line = new createjs.Shape();
                line.graphics.setStrokeStyle(3);
                line.graphics.beginStroke("#000");
                line.graphics.moveTo(glcnac1.x, glcnac1.y);
                line.graphics.lineTo(glcnac2.x, glcnac2.y);
                stage.addChild(line);
                structure.edge = line;
                var edgeText = new createjs.Text("b1-4","12px serif", "rgb(255,0,0)");
                edgeText.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x)/2;
                edgeText.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y)/2;
                stage.addChild(edgeText);
                structure.edgeInformamtion = edgeText;
                structures[structureKey] = structure;
                structureKey++;
                structure_id++;
                stage.removeChild(man1);
                stage.removeChild(man2);
                stage.removeChild(man3);
                stage.removeChild(glcnac1);
                stage.removeChild(glcnac2);
                stage.addChild(man1);
                stage.addChild(man2);
                stage.addChild(man3);
                stage.addChild(glcnac1);
                stage.addChild(glcnac2);
                stage.update();
                Range();
            }
        }
    };

    function SelectMove(){
        if(selectRange != null){
            stage.removeChild(selectRange);
            stage.update();
        }
        XY(event);
        var shape = new createjs.Shape();
        shape.graphics.beginStroke("rgb(0, 0, 0)");
        shape.graphics.beginFill("rgb(255, 255, 255)");
        if(selectX < mouseX || selectY < mouseY) {
            shape.graphics.drawRect( selectX, selectY,mouseX - selectX, mouseY - selectY);
        }
        else if(selectX > mouseX && selectY > mouseY){
            shape.graphics.drawRect(mouseX, mouseY, selectX - mouseX, selectY - mouseY);
        }

        shape.alpha = 0.3;
        selectRange = shape;
        stage.addChild(shape);
        stage.update();
    }

    function SelectUp(){
        for(var i = 0; i < nodes.length; i++){
            if(selectX < mouseX || selectY < mouseY) {
                if (selectX < nodes[i].x && mouseX > nodes[i].x && selectY < nodes[i].y && mouseY > nodes[i].y) {
                    nodes[i].graphics._stroke.style = "rgb(204, 0, 0)";
                    nodes[i].alpha = 0.5;
                    moveStructureNodes[moveStructuresNodesKey] = nodes[i];
                    moveStructuresNodesKey++;
                }
            }
            else if(selectX > mouseX && selectY > mouseY) {
                if(mouseX < nodes[i].x && selectX > nodes[i].x && mouseY < nodes[i].y && selectY > nodes[i].y){
                    nodes[i].graphics._stroke.style = "rgb(204, 0, 0)";
                    nodes[i].alpha = 0.5;
                    moveStructureNodes[moveStructuresNodesKey] = nodes[i];
                    moveStructuresNodesKey++;
                }
            }
        }
        for(i = 0; i < moveStructureNodes.length; i++){
            moveStructureNodes[i].addEventListener("mousedown", SelectMoveStructureDown);
        }
        stage.removeChild(selectRange);
        document.addEventListener("contextmenu", SelectStructureDelete,false);
        stage.update();
        canvas.removeEventListener("mousemove", SelectMove);
        canvas.removeEventListener("mouseup", SelectUp);
    }

    function SelectStructureDelete(){
        if(mode != 1) return;
        canvas.removeEventListener("mousemove", SelectMove);
        canvas.removeEventListener("mouseup", SelectUp);
        window.removeEventListener("mousedown", WindowClick);
        var res = confirm("Do you delete Selected structure?");
        if(res == true){
            for(var i = 0; i < moveStructureNodes.length; i++){
                for(var j = 0; j < structures.length; j++){
                    if(moveStructureNodes[i].param.id === structures[j].Node1.param.id || moveStructureNodes[i].param.id === structures[j].Node2.param.id){
                        stage.removeChild(structures[j].edge);
                        stage.removeChild(structures[j].edgeInformamtion);
                        structures.splice(j, 1);
                    }
                    if(moveStructureNodes[i] ===  nodes[j]){
                        nodes.splice(j, 1);
                    }
                }
                stage.removeChild(moveStructureNodes[i]);
            }
            if(structures.length != 0) {
                for (i = 0; i < structures.length; i++) {
                    structures[i].structureId = structure_id;
                    structure_id++;
                }
            }
            if(nodes.length != 0) {
                for (i = 0; i < nodes.length; i++) {
                    nodes[i].param.id = node_id;
                    node_id++;
                }
            }
            for(i = 0; i < moveStructureNodes.length; i++){
                moveStructureNodes[i].removeEventListener("mousedown", SelectMoveStructureDown);
            }
            moveStructureNodes.splice(0, moveStructureNodes.length);
            moveStructuresNodesKey = 0;
            document.removeEventListener("contextmenu", SelectStructureDelete,false);
            window.addEventListener("mousedown",WindowClick);
        }
        structureKey = structures.length;
        nodeKey = nodes.length;
    }


    function SelectMoveStructureDown(event){
        window.removeEventListener("mousedown",WindowClick);
        var target = event.target;
        for(var i = 0; i < moveStructureNodes.length; i++) {
            drawStructureXPoints[i] = stage.mouseX - moveStructureNodes[i].x;
            drawStructureYPoints[i] = stage.mouseY - moveStructureNodes[i].y;
        }
        for(i = 0; i < moveStructureNodes.length; i++){
            for(var j = 0; j < structures.length; j++){
                if(moveStructureNodes[i].param.id === structures[j].Node1.param.id){
                    targetMoveStructureNode1[targetMoveStructureKey1] = structures[j];
                    targetMoveStructureKey1++;
                }
                else if(moveStructureNodes[i].param.id === structures[j].Node2.param.id){
                    targetMoveStructureNode2[targetMoveStructureKey2] = structures[j];
                    targetMoveStructureKey2++;
                }
            }
        }
        target.addEventListener("pressmove", SelectMoveStructureMove);
        target.addEventListener("pressup", SelectMoveStructureUp);
    }

    function SelectMoveStructureMove(){
        if(mode != 1 && mode != 7) return;
        canvas.removeEventListener("mousemove", SelectMove);
        canvas.removeEventListener("mouseup", SelectUp);

        for(var i = 0; i < moveStructureNodes.length; i++){
            var movePointX = stage.mouseX - drawStructureXPoints[i];
            var movePointY = stage.mouseY - drawStructureYPoints[i];
            if(movePointX > 0 + 10 && movePointX  < canvas.width - 10){
                moveStructureNodes[i].x = stage.mouseX - drawStructureXPoints[i];
            }
            if(movePointY > 0 + 10 && movePointY < canvas.height - 10) {
                moveStructureNodes[i].y = stage.mouseY - drawStructureYPoints[i];
            }
        }
        for(i = 0; i < moveStructureNodes.length; i++){
            for(var j = 0; j < targetMoveStructureNode1.length; j++) {
                if (targetMoveStructureNode1.length != 0) {
                    if (moveStructureNodes[i] === targetMoveStructureNode1[j].Node1) {
                        stage.removeChild(targetMoveStructureNode1[j].edge);
                        var line = new createjs.Shape();
                        line.graphics.setStrokeStyle(3);
                        line.graphics.beginStroke("#000");
                        line.graphics.moveTo(targetMoveStructureNode1[j].Node2.x, targetMoveStructureNode1[j].Node2.y);
                        line.graphics.lineTo(moveStructureNodes[i].x, moveStructureNodes[i].y);
                        stage.addChild(line);
                        stage.removeChild(targetMoveStructureNode1[j].Node2);
                        stage.removeChild(moveStructureNodes[i]);
                        stage.addChild(targetMoveStructureNode1[j].Node2);
                        stage.addChild(moveStructureNodes[i]);
                        if (targetMoveStructureNode1[j] != null) {
                            stage.removeChild(targetMoveStructureNode1[j].edgeInformamtion);
                            targetMoveStructureNode1[j].edgeInformamtion.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x) / 2;
                            targetMoveStructureNode1[j].edgeInformamtion.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y) / 2;
                        }
                        stage.addChild(targetMoveStructureNode1[j].edgeInformamtion);
                        stage.update();
                        targetMoveStructureNode1[j].edge = line;
                    }
                }
            }
            for(j = 0; j < targetMoveStructureNode2.length; j++) {
                if (targetMoveStructureNode2.length != 0) {
                    if (moveStructureNodes[i] === targetMoveStructureNode2[j].Node2) {
                        stage.removeChild(targetMoveStructureNode2[j].edge);
                        var line = new createjs.Shape();
                        line.graphics.setStrokeStyle(3);
                        line.graphics.beginStroke("#000");
                        line.graphics.moveTo(targetMoveStructureNode2[j].Node1.x, targetMoveStructureNode2[j].Node1.y);
                        line.graphics.lineTo(moveStructureNodes[i].x, moveStructureNodes[i].y);
                        stage.addChild(line);
                        stage.removeChild(targetMoveStructureNode2[j].Node1);
                        stage.removeChild(moveStructureNodes[i]);
                        stage.addChild(targetMoveStructureNode2[j].Node1);
                        stage.addChild(moveStructureNodes[i]);
                        if (targetMoveStructureNode2[j] != null) {
                            stage.removeChild(targetMoveStructureNode2[j].edgeInformamtion);
                            targetMoveStructureNode2[j].edgeInformamtion.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x) / 2;
                            targetMoveStructureNode2[j].edgeInformamtion.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y) / 2;
                        }
                        stage.addChild(targetMoveStructureNode2[j].edgeInformamtion);
                        stage.update();
                        targetMoveStructureNode2[j].edge = line;
                    }
                }
            }
        }
    }

    function SelectMoveStructureUp(event){
        if(mode != 1 && mode != 7) return;
        var target = event.target;
        for(var i = 0; i < moveStructureNodes.length; i++){
            moveStructureNodes[i].graphics._stroke.style = "rgb(0, 0, 0)";
            moveStructureNodes[i].alpha = 1.0;
            moveStructureNodes[i].removeEventListener("mousedown", SelectMoveStructureDown);
            moveStructureNodes[i].removeEventListener("contextmenu", SelectStructureDelete);
        }
        moveStructureNodes.splice(0, moveStructureNodes.length);
        moveStructuresNodesKey = 0;
        targetMoveStructureNode1.splice(0, targetMoveStructureNode1.length);
        targetMoveStructureNode2.splice(0, targetMoveStructureNode2.length);
        targetMoveStructureKey1 = 0;
        targetMoveStructureKey2 = 0;
        drawStructureXPoints.splice(0,drawStructureXPoints.length);
        drawStructureYPoints.splice(0,drawStructureYPoints.length);
        target.removeEventListener("pressmove", SelectMoveStructureMove);
        target.removeEventListener("pressup", SelectMoveStructureUp);
        window.addEventListener("mousedown",WindowClick);
        document.removeEventListener("contextmenu", SelectStructureDelete,false);
    }

    // Edge Move Node
    function handleDown(event) {
        if (mode != 3 && mode != 6 && mode != 7) return;
        if (mode === 3) {
            if (edgeCount === 0) {
                edgeStart = event.target;
                startX = edgeStart.x;
                startY = edgeStart.y;
                edgeStart.alpha = 0.5;
                edgeCount = 1;
            }
            else {
                var edgeEnd = event.target;
                var structure = new Structure(structure_id, edgeStart, edgeEnd, null);
                var line = new createjs.Shape();
                line.graphics.setStrokeStyle(3);
                line.graphics.beginStroke("#000");
                line.graphics.moveTo(startX, startY);
                line.graphics.lineTo(edgeEnd.x, edgeEnd.y);
                stage.addChild(line);
                stage.removeChild(edgeStart);
                stage.removeChild(edgeEnd);
                stage.addChild(edgeStart);
                stage.addChild(edgeEnd);
                stage.update();
                edgeStart.alpha = 1.0;
                edgeCount = 0;
                structure.edge = line;
                structures[structureKey] = structure;
                structure.edge.addEventListener("click", edgeClick);
                structureKey++;
                structure_id++;
            }
        }

        else if (mode === 6) {
            var target = event.target;
            var deleatStructures = new Array();
            var deleatKey = 0;
            var j = 0;
            for (var i = 0; i < structures.length; i++) {
                if (target.param.id === structures[i].Node1.param.id || target.param.id === structures[i].Node2.param.id) {
                    stage.removeChild(structures[i].edge);
                    if (structures[i].edgeInformamtion != null) {
                        stage.removeChild(structures[i].edgeInformamtion);
                    }
                    deleatStructures[deleatKey] = i;
                    deleatKey++;
                }
            }
            for (i = 0; i < deleatStructures.length; i++) {
                structures.splice(deleatStructures[i] - j, 1);
                j++;
            }
            for (i = 0; i < nodes.length; i++) {
                if (nodes[i].id === target.id) {
                    nodes.splice(i, 1);
                }
            }
            stage.removeChild(target);
            stage.update();
            structureKey = structures.length;
            nodeKey = nodes.length;
        }

        else if (mode === 7) {
            window.removeEventListener("mousedown",WindowClick);
            var target = event.target;
            target.graphics._stroke.style = "rgb(204, 0, 0)";
            target.alpha = 0.5;
            moveStructureNodes[moveStructuresNodesKey] = target;
            moveStructuresNodesKey++;
            for(var i = 0; i < moveStructureNodes.length; i++) {
                drawStructureXPoints[i] = stage.mouseX - moveStructureNodes[i].x;
                drawStructureYPoints[i] = stage.mouseY - moveStructureNodes[i].y;
            }
            for(i = 0; i < moveStructureNodes.length; i++){
                for(var j = 0; j < structures.length; j++){
                    if(moveStructureNodes[i].param.id === structures[j].Node1.param.id){
                        targetMoveStructureNode1[targetMoveStructureKey1] = structures[j];
                        targetMoveStructureKey1++;
                    }
                    else if(moveStructureNodes[i].param.id === structures[j].Node2.param.id){
                        targetMoveStructureNode2[targetMoveStructureKey2] = structures[j];
                        targetMoveStructureKey2++;
                    }
                }
            }
            target.addEventListener("pressmove", SelectMoveStructureMove);
            target.addEventListener("pressup", SelectMoveStructureUp);
        }
    }


    function edgeClick(event){
        var target = event.target;
        for(var i = 0; i < structures.length; i++){
            if(structures[i].edge === target){
                stage.removeChild(structures[i].edgeInformamtion);
            }
        }
        var edgeText = new createjs.Text(edgeKey,"12px serif", "rgb(255,0,0)");
        edgeText.x = (target.graphics._activeInstructions[0].x + target.graphics._activeInstructions[1].x)/2;
        edgeText.y = (target.graphics._activeInstructions[0].y + target.graphics._activeInstructions[1].y)/2;
        stage.addChild(edgeText);
        stage.update();
        for(var i = 0; i < structures.length; i++){
            if(structures[i].edge === target){
                structures[i].edgeInformamtion = edgeText;
            }
        }

    }
    function XY(e){
        var rect = e.target.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
    };


    function CreateTree(){
        if(nodes.length < 1){
            alert("Please build glycan.");
            return;
        }
        var orderStructure = new Array();
        for(var i = 0; i < structures.length; i++){
            orderStructure[i] = structures[i];
        }
        var rootNode = orderStructure[0].Node1;
        var childKey = 0;

        KCFTextOutId = 0;
        glycoTreeKey = 0;
        usedStructureKey = 0

        for(i = 0; i < orderStructure.length; i++){
            if(rootNode.x < orderStructure[i].Node1.x) rootNode = orderStructure[i].Node1;
            if(rootNode.x < orderStructure[i].Node2.x) rootNode = orderStructure[i].Node2;
        }
        var glycoTree = new GlycoTree();
        glycoTree.Node = rootNode;
        glycoTree.id = KCFTextOutId;
        KCFTextOutId++;
        glycoTrees[glycoTreeKey] = glycoTree;
        glycoTreeKey++;
        for(i = 0; i < orderStructure.length; i++){
            if(glycoTree.Node.param.id === orderStructure[i].Node1.param.id){
                usedStructures[usedStructureKey] = orderStructure[i];
                usedStructureKey++;
                glycoTree.children[childKey] = followTree(orderStructure, orderStructure[i].Node2,orderStructure[i].edgeInformamtion,glycoTree.id);
                childKey++;
            }
            else if(glycoTree.Node.param.id === orderStructure[i].Node2.param.id){
                usedStructures[usedStructureKey] = orderStructure[i];
                usedStructureKey++;
                glycoTree.children[childKey] = followTree(orderStructure, orderStructure[i].Node1, orderStructure[i].edgeInformamtion,glycoTree.id);
                childKey++;
            }
        }
        KCFTextOut();

    }

    function followTree(orderStructure, Node, linkage, parentId){
        var glycoTree = new GlycoTree();
        glycoTree.Node = Node;
        glycoTree.link = linkage;
        glycoTree.id = KCFTextOutId;
        glycoTree.parentId = parentId;
        KCFTextOutId++;
        glycoTrees[glycoTreeKey] = glycoTree;
        glycoTreeKey++;

        var childKey = 0;

        for(var i = 0; i < orderStructure.length; i++){
            for(var j = 0; j < usedStructures.length; j++){
                if(i >= orderStructure.length) break;
                else if(usedStructures[j].structureId === orderStructure[i].structureId){
                    i++;
                }
            }
            if(i >= orderStructure.length) break;
            if(glycoTree.Node.param.id === orderStructure[i].Node1.param.id){
                usedStructures[usedStructureKey] = orderStructure[i];
                usedStructureKey++;
                glycoTree.children[childKey] = followTree(orderStructure, orderStructure[i].Node2,orderStructure[i].edgeInformamtion, glycoTree.id);
                childKey++;
            }
            else if(glycoTree.Node.param.id === orderStructure[i].Node2.param.id){
                usedStructures[usedStructureKey] = orderStructure[i];
                usedStructureKey++;
                glycoTree.children[childKey] = followTree(orderStructure, orderStructure[i].Node1,orderStructure[i].edgeInformamtion, glycoTree.id);
                childKey++;
            }
        }
        return glycoTree;

    }

    function KCFTextOut(){
        var textArea = document.getElementById("kcf_format");

        if(mode === 8){
            var str = "ENTRY"+ TAB + TAB + TAB + "Glycan" + NEW_LINE + "NODE" + TAB + TAB + glycoTrees.length + NEW_LINE;
            var str2 = "EDGE" + TAB + TAB + structures.length + NEW_LINE;
        }
        else if(mode === 9){
            var date = new Date();
            var url = "http://www.rings.t.soka.ac.jp/cgi-bin/runmatching.pl?DrawRINGS" + date.getTime() + ".txt~";
            var str = "ENTRY" + URL_TAB + "Glycan" + URL_NEW_LINE + "NODE" + URL_TAB + glycoTrees.length + URL_NEW_LINE;
            var str2 = "EDGE" + URL_TAB + structures.length + URL_NEW_LINE;
        }
        for(var i = 0; i < glycoTrees.length; i++){
            if(i != 0){
                glycoTrees[i].Node.param.sortParamX = glycoTrees[i].Node.x - glycoTrees[0].Node.x;
                glycoTrees[i].Node.param.sortParamY = glycoTrees[i].Node.y - glycoTrees[0].Node.y;
            }
            glycoTrees[i].id++;
            if(mode === 8) {
                str += TAB + glycoTrees[i].id + TAB + glycoTrees[i].Node.param.monosaccharide + TAB + glycoTrees[i].Node.param.sortParamX + TAB + glycoTrees[i].Node.param.sortParamY + NEW_LINE;
            }
            else if(mode === 9){
                str += URL_TAB + glycoTrees[i].id + URL_TAB + glycoTrees[i].Node.param.monosaccharide + URL_TAB + glycoTrees[i].Node.param.sortParamX + URL_TAB + glycoTrees[i].Node.param.sortParamY + URL_NEW_LINE;
            }
        }
        var KCFEdgeID = 0;
        str2 += KCFTextOutEdge(glycoTrees[0], KCFEdgeID+1, "");
        glycoTreeKey = 0;

        if(mode === 8) {
            textArea.value = str + str2 + SLASH;
        }
        else if(mode === 9) {
            var runQueryUrl = url + str + str2 + SLASH + WAVE + document.scoreMatrix.scoreSelect.value + WAVE;
            for (var i = 0; i < document.kindRnuQueryResult.type.length; i++){
                if (document.kindRnuQueryResult.type[i].checked == true) {
                    var kindRunQueryResultType = document.kindRnuQueryResult.type[i].value;
                }
            }
            runQueryUrl += kindRunQueryResultType + WAVE + document.database.databaseSelect.value;

//                + "~none~0~All";
            window.open(runQueryUrl,"_blank");
            //console.log(textArea.value);
        }
        usedStructures.splice( 0, usedStructures.length );
        glycoTrees.splice(0, glycoTrees.length);
    }

    function KCFTextOutEdge(glycoTree, KCFEdgeID, str){
        var str2 = str;
        var anomer = "";
        var reduction = -1;
        var non_reduction = -1;
        for(var i = 0; i < glycoTree.children.length; i++){
            var child = glycoTree.children[i];
            if(child.link != null){
                if(child.link.text.match(/^[a]/)){
                    anomer = 'a';
                }
                else{
                    anomer = 'b';
                }
                for(var j = 1; j <= 6; j++){
                    for(var k = 1; k <= 6; k++){
                        if(child.link.text == anomer + j + "-" + k){
                            reduction = k;
                            non_reduction = j;
                        }
                    }
                }
                if(mode === 8) {
                    str2 += TAB + KCFEdgeID + TAB + child.id + COLON + anomer + non_reduction + TAB + glycoTree.id + COLON + reduction + NEW_LINE;
                }
                else if(mode === 9){
                    str2 += URL_TAB + KCFEdgeID + URL_TAB + child.id + COLON + anomer + non_reduction + URL_TAB + glycoTree.id + COLON + reduction + URL_NEW_LINE;
                }
                KCFEdgeID++;

            }
            str2 = KCFTextOutEdge(glycoTree.children[i], KCFEdgeID, str2);
        }
        return str2;
    }

    function DrawKCF() {
        var text = fileLoadTextareaId.value.replace(/\s/g, "space");
        var splitKCFs = text.split("space");
        var DrawKCFNodeObject = function(number, monosaccharide, x, y){
            this.nodeNumber = number;
            this.monosaccharide = monosaccharide;
            this.paramX = x;
            this.paramY = y;
        }
        var DrawKCFEdgeObject = function(anomer, childId, chaildLinkagePosition, parentId, parentLinkagePosition){
            this.anomer = anomer;
            this.childId = childId;
            this.childLinkagePsition = chaildLinkagePosition;
            this.parentId = parentId;
            this.parentLinkagePosition = parentLinkagePosition;
        }
        var DrawKCFNodeObjects = new Array();
        var DrawKCFNodeObjectsKey = 0;
        var DrawKCFEdgeObjects = new Array;
        var DrawKCFEdgeObjectKey = 0;
        for(var i = 0; i < splitKCFs.length; i++){
            if(splitKCFs[i] === ""){
                splitKCFs.splice(i,1);
                i--;
            }
        }
        if(splitKCFs[0] != "ENTRY"){
            alert("please write KCF format.\n for exsample \" ENTRY    Glycan...\"");
            return;
        }
        else if(splitKCFs[2] != "NODE"){
            return;
        }
        else{
            for(i = 4; i < splitKCFs.length; i = i + 4) {
                if(splitKCFs[i] === "EDGE"){
                    break;
                }
                else {
                    var DrawKCFNode = new DrawKCFNodeObject(splitKCFs[i],splitKCFs[i + 1], splitKCFs[i + 2], splitKCFs[i + 3]);
                    DrawKCFNodeObjects[DrawKCFNodeObjectsKey] = DrawKCFNode;
                    DrawKCFNodeObjectsKey++;
                }
            }
            i = i + 2;
            for( i; i < splitKCFs.length; i = i + 3 ){
                if(splitKCFs[i] === SLASH){
                    break;
                }
                var childNodeInformations = splitKCFs[i+1].split("");
                var parentNodeInformations = splitKCFs[i+2].split("");
                var DrawKCFEdge = new DrawKCFEdgeObject(childNodeInformations[2], childNodeInformations[0], childNodeInformations[3], parentNodeInformations[0], parentNodeInformations[2]);
                DrawKCFEdgeObjects[DrawKCFEdgeObjectKey] = DrawKCFEdge;
                DrawKCFEdgeObjectKey++;
            }


//        alert("Please set linkage information in KCF format. \n for exsample \"EDGE   number of EDGE \"");
        }
        buildGlycan(DrawKCFNodeObjects, DrawKCFEdgeObjects);
        console.log(splitKCFs);
    };

    function buildGlycan(DrawKCFNodeObjects, DrawKCFEdgeObjects){
        //単糖の距離のsort
        var sortMinX = parseInt(DrawKCFNodeObjects[0].paramX,10);
        var sortMinY = parseInt(DrawKCFNodeObjects[0].paramY,10);
        var sortMaxX = parseInt(DrawKCFNodeObjects[0].paramX,10);
        var sortMaxY = parseInt(DrawKCFNodeObjects[0].paramY,10);
        for(var i = 1; i < DrawKCFNodeObjects.length; i++){
            if(sortMinX > parseInt(DrawKCFNodeObjects[i].paramX,10)){
                sortMinX = parseInt(DrawKCFNodeObjects[i].paramX,10);
            }
            else if(sortMaxX < parseInt(DrawKCFNodeObjects[i].paramX,10)){
                sortMaxX = parseInt(DrawKCFNodeObjects[i].paramX,10);
            }
            if(sortMinY > parseInt(DrawKCFNodeObjects[i].paramY,10)){
                sortMinY = parseInt(DrawKCFNodeObjects[i].paramY,10);
            }
            else if(sortMaxY < parseInt(DrawKCFNodeObjects[i].paramY,10)){
                sortMaxY = parseInt(DrawKCFNodeObjects[i].paramY,10);
            }
        }
        var sortAverageX = sortMinX + (sortMaxX - sortMinX)/2;
        var sortAverageY = sortMinY + (sortMaxY - sortMinY)/2;
        for(i = 0; i < DrawKCFNodeObjects.length; i++){
            DrawKCFNodeObjects[i].paramX = parseInt(DrawKCFNodeObjects[i].paramX,10) - sortAverageX;
            DrawKCFNodeObjects[i].paramY = parseInt(DrawKCFNodeObjects[i].paramY,10) - sortAverageY;
        }
        sortAverageX =  canvas.width/2;
        sortAverageY = canvas.height/2;
        for(i = 0; i < DrawKCFNodeObjects.length; i++){
            DrawKCFNodeObjects[i].paramX = sortAverageX + DrawKCFNodeObjects[i].paramX;
            DrawKCFNodeObjects[i].paramY = sortAverageY + DrawKCFNodeObjects[i].paramY;
        }

        //Node
        for(i = 0; i < DrawKCFNodeObjects.length; i++){
            for(var j = 100; j < 1107; j++){
                if(nodeHash[j] === DrawKCFNodeObjects[i].monosaccharide){
                    nodeHashKey = j;
                }
            }
            kindNode.draw(DrawKCFNodeObjects[i].paramX, DrawKCFNodeObjects[i].paramY);
        }

        //Edge
        var childNode;
        var parentNode;
        var parentNodeObject;
        var childNodeObject;
        for(i = 0; i < DrawKCFEdgeObjects.length; i++) {
            for (j = 0; j < DrawKCFNodeObjects.length; j++) {
                if (DrawKCFEdgeObjects[i].childId === DrawKCFNodeObjects[j].nodeNumber) {
                    childNode = DrawKCFNodeObjects[j];
                }
                else if (DrawKCFEdgeObjects[i].parentId === DrawKCFNodeObjects[j].nodeNumber) {
                    parentNode = DrawKCFNodeObjects[j];
                }
            }
            for (j = 0; j < nodes.length; j++) {
                if(nodes[j].x === parentNode.paramX && nodes[j].y === parentNode.paramY){
                    parentNodeObject = nodes[j];
                }
                else if(nodes[j].x === childNode.paramX && nodes[j].y === childNode.paramY){
                    childNodeObject = nodes[j];
                }
            }

            var structure = new Structure(structure_id, parentNodeObject, childNodeObject, null);
            var line = new createjs.Shape();
            line.graphics.setStrokeStyle(3);
            line.graphics.beginStroke("#000");
            line.graphics.moveTo(parentNode.paramX, parentNode.paramY);
            line.graphics.lineTo(childNode.paramX, childNode.paramY);
            stage.addChild(line);
            structure.edge = line;
            var edgeText = new createjs.Text(DrawKCFEdgeObjects[i].anomer + DrawKCFEdgeObjects[i].childLinkagePsition + "-" + DrawKCFEdgeObjects[i].parentLinkagePosition,"12px serif", "rgb(255,0,0)");
            edgeText.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x)/2;
            edgeText.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y)/2;
            stage.addChild(edgeText);
            structure.edgeInformamtion = edgeText;
            structures[structureKey] = structure;
            structureKey++;
            structure_id++;
            stage.removeChild(parentNodeObject);
            stage.removeChild(childNodeObject);
            stage.addChild(parentNodeObject);
            stage.addChild(childNodeObject);
        }

        stage.update();
        DrawKCFNodeObjects.splice( 0, DrawKCFNodeObjects.length);
        DrawKCFEdgeObjects.splice(0, DrawKCFEdgeObjects.length);
        Range();
    }

    function Range(){
        var outOfLeftCanvas = 0;
        var outOfRightCanvas = 0;
        var outOfTopCanvas = 0;
        var outOfBottomCanvas = 0;
        if(structureKey != 0) {
            for (var i = 0; i < structures.length; i++) {
                if (structures[i].Node1.x < 0 || structures[i].Node2.x < 0) {
                    outOfLeftCanvas++;
                }
                if (structures[i].Node1.x > canvas.width || structures[i].Node2.x > canvas.width) {
                    outOfRightCanvas++;
                }
                if (structures[i].Node1.y < 0 || structures[i].Node2.y < 0) {
                    outOfTopCanvas++;
                }
                if (structures[i].Node1.y > canvas.height || structures[i].Node2.y > canvas.height) {
                    outOfBottomCanvas++;
                }
            }
            if (outOfRightCanvas != 0 || outOfLeftCanvas != 0 || outOfTopCanvas != 0 || outOfBottomCanvas != 0) {
                var sortMinX = structures[0].Node1.x;
                var sortMinY = structures[0].Node1.y;
                var sortMaxX = structures[0].Node1.x;
                var sortMaxY = structures[0].Node1.y;
                var paramPlusX = new Array();
                var paramMinusX = new Array();
                var paramPlusY = new Array();
                var paramMinusY = new Array();
                var paramPlusXKey = 0;
                var paramMinusXKey = 0;
                var paramPlusYKey = 0;
                var paramMinusYKey = 0;
                for (var i = 0; i < structures.length; i++) {
                    if (sortMinX > structures[i].Node1.x) {
                        sortMinX = structures[i].Node1.x;
                    }
                    else if (sortMaxX < structures[i].Node1.x) {
                        sortMaxX = structures[i].Node1.x;
                    }
                    if (sortMinY > structures[i].Node1.y) {
                        sortMinY = structures[i].Node1.y;
                    }
                    else if (sortMaxY < structures[i].Node1.y) {
                        sortMaxY = structures[i].Node1.y;
                    }
                    if (sortMinX > structures[i].Node2.x) {
                        sortMinX = structures[i].Node2.x;
                    }
                    else if (sortMaxX < structures[i].Node2.x) {
                        sortMaxX = structures[i].Node2.x;
                    }
                    if (sortMinY > structures[i].Node2.y) {
                        sortMinY = structures[i].Node2.y;
                    }
                    else if (sortMaxY < structures[i].Node2.y) {
                        sortMaxY = structures[i].Node2.y;
                    }
                }
                var sortAverageX = (sortMaxX - sortMinX) / 2 + sortMinX;
                var sortAverageY = (sortMaxY - sortMinY) / 2 + sortMinY;
                for (i = 0; i < structures.length; i++) {
                    structures[i].Node1.param.sortParamX = structures[i].Node1.x - sortAverageX;
                    structures[i].Node1.param.sortParamY = structures[i].Node1.y - sortAverageY;
                    structures[i].Node2.param.sortParamX = structures[i].Node2.x - sortAverageX;
                    structures[i].Node2.param.sortParamY = structures[i].Node2.y - sortAverageY;
                }
                sortAverageX = canvas.width / 2;
                sortAverageY = canvas.height / 2;
                var calculationNodes = new Array();
                var calcureationsKey = 1;
                calculationNodes[0] = structures[0].Node1;
                structures[0].Node1.param.sortParamX = sortAverageX + structures[0].Node1.param.sortParamX;
                structures[0].Node1.param.sortParamY = sortAverageY + structures[0].Node1.param.sortParamY;
                for (i = 0; i < structures.length; i++) {
                    var usedNode1 = 0;
                    var usedNode2 = 0
                    for (j = 0; j < calculationNodes.length; j++) {
                        if (calculationNodes[j] === structures[i].Node1) {
                            usedNode1++;
                        }
                        else if (calculationNodes[j] === structures[i].Node2) {
                            usedNode2++;
                        }
                    }
                    if (usedNode1 === 0) {
                        structures[i].Node1.param.sortParamX = sortAverageX + structures[i].Node1.param.sortParamX;
                        structures[i].Node1.param.sortParamY = sortAverageY + structures[i].Node1.param.sortParamY;
                        calculationNodes[calcureationsKey] = structures[i].Node1;
                        calcureationsKey++;
                    }
                    if (usedNode2 === 0) {
                        structures[i].Node2.param.sortParamX = sortAverageX + structures[i].Node2.param.sortParamX;
                        structures[i].Node2.param.sortParamY = sortAverageY + structures[i].Node2.param.sortParamY;
                        calculationNodes[calcureationsKey] = structures[i].Node2;
                        calcureationsKey++;
                    }
                }
                for(i = 0; i < structures.length; i++){
                    if (structures[i].Node1.param.sortParamX - sortAverageX > 0) {
                        paramPlusX[paramPlusXKey] = structures[i].Node1;
                        paramPlusXKey++;
                    }
                    else if (structures[i].Node1.param.sortParamX - sortAverageX <= 0) {
                        paramMinusX[paramMinusXKey] = structures[i].Node1;
                        paramMinusXKey++;
                    }
                    if (structures[i].Node2.param.sortParamX - sortAverageX > 0) {
                        paramPlusX[paramPlusXKey] = structures[i].Node2;
                        paramPlusXKey++;
                    }
                    else if (structures[i].Node2.param.sortParamX - sortAverageX <= 0) {
                        paramMinusX[paramMinusXKey] = structures[i].Node2;
                        paramMinusXKey++;
                    }
                    if (structures[i].Node1.param.sortParamY - sortAverageY > 0) {
                        paramPlusY[paramPlusYKey] = structures[i].Node1;
                        paramPlusYKey++;
                    }
                    else if (structures[i].Node1.param.sortParamY - sortAverageY <= 0) {
                        paramMinusY[paramMinusYKey] = structures[i].Node1;
                        paramMinusYKey++;
                    }
                    if (structures[i].Node2.param.sortParamY - sortAverageY > 0) {
                        paramPlusY[paramPlusYKey] = structures[i].Node2;
                        paramPlusYKey++;
                    }
                    else if (structures[i].Node2.param.sortParamY - sortAverageY <= 0) {
                        paramMinusY[paramMinusYKey] = structures[i].Node2;
                        paramMinusYKey++;
                    }
                }
                if (paramPlusXKey >= 1) {
                    paramPlusX = selectionSortX(paramPlusX);
                }
                if (paramMinusXKey >= 1) {
                    paramMinusX = selectionSortX(paramMinusX);
                }
                if (paramPlusYKey >= 1) {
                    paramPlusY = selectionSortY(paramPlusY);
                }
                if (paramMinusYKey >= 1) {
                    paramMinusY = selectionSortY(paramMinusY);
                }
                var distance = 50;
                var counter = 100;
                recursionSetCoordinateX(paramPlusX, paramMinusX, distance, sortAverageX, counter);
                distance = 0;
                counter = 50;
                recursionSetCoordinateY(paramPlusY, paramMinusY, distance, sortAverageY, counter);
                for (i = 0; i < structures.length; i++) {
                    stage.removeChild(structures[i].edge);
                    var line = new createjs.Shape();
                    line.graphics.setStrokeStyle(3);
                    line.graphics.beginStroke("#000");
                    line.graphics.moveTo(structures[i].Node1.x, structures[i].Node1.y);
                    line.graphics.lineTo(structures[i].Node2.x, structures[i].Node2.y);
                    structures[i].edge = line;
                    structures[i].edgeInformamtion.x = (line.graphics._activeInstructions[0].x + line.graphics._activeInstructions[1].x) / 2;
                    structures[i].edgeInformamtion.y = (line.graphics._activeInstructions[0].y + line.graphics._activeInstructions[1].y) / 2;
                    stage.removeChild(structures[i].edgeInformamtion);
                }
                var usedNodes = new Array();
                var usedNodesKey = 2;
                for (i = 0; i < structures.length; i++) {
                    var countNode1 = 0;
                    var countNode2 = 0;
                    if (i === 0) {
                        stage.removeChild(structures[i].Node1);
                        stage.removeChild(structures[i].Node2);
                        usedNodes[0] = structures[i].Node1;
                        usedNodes[1] = structures[i].Node2;
                    }
                    for (var j = 0; j < usedNodes.length; j++) {
                        if (structures[i].Node1 === usedNodes[j]) {
                            countNode1++;
                        }
                        else if (structures[i].Node2 === usedNodes[j]) {
                            countNode2++;
                        }
                    }
                    if (countNode1 != 1 && countNode2 === 1) {
                        stage.removeChild(structures[i].Node1);
                        usedNodes[usedNodesKey] = structures[i].Node1;
                        usedNodesKey++;
                    }
                    else if (countNode1 === 1 && countNode2 != 1) {
                        stage.removeChild(structures[i].Node2);
                        usedNodes[usedNodesKey] = structures[i].Node2
                        usedNodesKey++;

                    }
                    else if(countNode1 != 1 && countNode2 != 1){
                        stage.removeChild(structures[i].Node1);
                        stage.removeChild(structures[i].Node2);
                        usedNodes[usedNodesKey] = structures[i].Node1;
                        usedNodesKey++;
                        usedNodes[usedNodesKey] = structures[i].Node2
                        usedNodesKey++;
                    }
                    stage.addChild(structures[i].edge);
                    stage.addChild(structures[i].edgeInformamtion);
                }
                for (i = 0; i < usedNodes.length; i++) {
                    stage.addChild(usedNodes[i]);
                }
                stage.update();
            }
        }
    }

    function selectionSortX(sortValues){
        for(var i = 0; i < sortValues.length - 1; i++){
            var min = i;
            for(var j = i + 1; j < sortValues.length; j++){
                if(sortValues[j].param.sortParamX < sortValues[min].param.sortParamX){
                    var t = sortValues[min];
                    sortValues[min] = sortValues[j];
                    sortValues[j] = t;
                }
            }
        }

        return sortValues;
    }

    function selectionSortY(sortValues){
        for(var i = 0; i < sortValues.length - 1; i++){
            var min = i;
            for(var j = i + 1; j < sortValues.length; j++){
                if(sortValues[j].param.sortParamY < sortValues[min].param.sortParamY){
                    var t = sortValues[min];
                    sortValues[min] = sortValues[j];
                    sortValues[j] = t;
                }
            }
        }
        return sortValues;
    }

    function recursionSetCoordinateX(paramPlusX, paramMinusX, distance, sortAverageX, counter){
        var originalDistance = distance;
        paramPlusX[0].x = sortAverageX + distance;
        paramMinusX[paramMinusX.length - 1].x = sortAverageX - distance;
        var setedNode = new Array();
        var setedNodeKey = 1;
        var sameNode = 0;
        setedNode[0] = paramPlusX[0];

        for(var i = 1; i < paramPlusX.length; i++) {
            sameNode = 0;
            for (var j = 0; j < setedNode.length; j++) {
                if (paramPlusX[i] === setedNode[j]) {
                    sameNode++;
                }
            }
            if (sameNode === 0) {
                var different = 0;
                for (var j = 0; j < i; j++) {
                    if (paramPlusX[i] != paramPlusX[j]) {
                        if (paramPlusX[i].param.sortParamX === paramPlusX[j].param.sortParamX) {
                            different++;
                        }
                    }
                }
                if (different === 0) {
                    distance = distance + counter;
                }
                paramPlusX[i].x = sortAverageX + distance;
                setedNode[setedNodeKey] = paramPlusX[i];
                setedNodeKey++;
                sameNode = 0;
            }
        }
        setedNode.splice(0, setedNode.length);
        setedNode[0] = paramMinusX[paramMinusX.length - 1];
        setedNodeKey = 1;
        distance = originalDistance;
        for(var i = paramMinusX.length - 2; i >= 0; i--) {
            sameNode = 0;
            for (var j = 0; j < setedNode.length; j++) {
                if (paramMinusX[i] === setedNode[j]) {
                    sameNode++;
                }
            }
            if (sameNode === 0) {
                var different = 0;
                for (var j = paramMinusX.length - 1; j > i; j--) {
                    if (paramMinusX[i] != paramMinusX[j]) {
                        if (paramMinusX[i].param.sortParamX === paramMinusX[j].param.sortParamX) {
                            different++;
                        }
                    }
                }
                if (different === 0) {
                    distance = distance + counter;
                }
                paramMinusX[i].x = sortAverageX - distance;
                setedNode[setedNodeKey] = paramMinusX[i];
                setedNodeKey++;
            }
        }
        if(counter === 20){
            return;
        }
        else{
            for(i = 0; i < paramPlusX.length; i++){
                if(paramPlusX[i].x + 10  > canvas.width) {
                    recursionSetCoordinateX(paramPlusX, paramMinusX, originalDistance-10, sortAverageX, counter-10)
                }
            }
            for(i = 0; i < paramMinusX.length; i++){
                if(paramMinusX[i].x - 10 < 0){
                    recursionSetCoordinateX(paramPlusX, paramMinusX, originalDistance-10, sortAverageX, counter-10)
                }
            }
        }
    }

    function recursionSetCoordinateY(paramPlusY, paramMinusY, distance, sortAverageY, counter){
        var originalDistance = distance;
        var setedNode = new Array();
        var setedNodeKey = 0;
        for(var i = 0; i < paramPlusY.length; i++){
            var sameNode = 0;
            if(setedNodeKey != 0) {
                for (var j = 0; j < setedNode.length; j++) {
                    if(paramPlusY[i] === setedNode[j]){
                        sameNode++;
                    }
                }
            }
            if(sameNode === 0) {
                var different = 0;
                for (var j = 0; j < i; j++) {
                    if (paramPlusY[i] != paramPlusY[j]) {
                        if (paramPlusY[i].param.sortParamY === paramPlusY[j].param.sortParamY) {
                            different++;
                        }
                    }
                }
                if (different === 0) {
                    distance = distance + counter;
                }
                paramPlusY[i].y = sortAverageY + distance;
                setedNode[setedNodeKey] = paramPlusY[i];
                setedNodeKey++;
            }
        }
        distance = originalDistance;
        setedNode.splice(0, setedNode.length);
        setedNodeKey = 0;
        for(i = paramMinusY.length - 1; i >= 0 ; i--){
            if(paramMinusY[i].param.sortParamY >= sortAverageY){
                paramMinusY[i].y = paramMinusY[i].param.sortParamY;
                continue;
            }
            var sameNode = 0;
            if(setedNodeKey != 0) {
                for (var j = 0; j < setedNode.length; j++) {
                    if(paramPlusY[i] === setedNode[j]){
                        sameNode++;
                    }
                }
            }

            if(sameNode === 0) {
                var different = 0;
                for (var j = paramMinusY.length - 1; j >i ; j--) {
                    if (paramMinusY[i] != paramMinusY[j]) {
                        if (paramMinusY[i].param.sortParamY === paramMinusY[j].param.sortParamY) {
                            different++;
                        }
                    }
                }
                if (different === 0) {
                    distance = distance + counter;
                }
                paramMinusY[i].y = sortAverageY - distance;
                setedNode[setedNodeKey] = paramMinusY[i];
                setedNodeKey++;
            }
        }
        if(counter === 20){
            return;
        }
        else{
            for(i = 0; i < paramPlusY.length; i++){
                if(paramPlusY[i].y + 10  > canvas.height) {
                    recursionSetCoordinateY(paramPlusY, paramMinusY, originalDistance, sortAverageY, counter-10)
                }
            }
            for(i = 0; i < paramMinusY.length; i++){
                if(paramMinusY[i].y - 10 < 0){
                    recursionSetCoordinateY(paramPlusY, paramMinusY, originalDistance, sortAverageY, counter-10)
                }
            }
        }
    }





    function textClear(){
        var res = confirm("Textarea clear all?");
        if(res === true){
            var textArea = document.getElementById("kcf_format");
            textArea.value = "KCF-Text";
        }
    }


    createjs.Ticker.addEventListener("tick", handleTick);
    function handleTick() {
        stage.update(); // 画面更新
    }

</script>

</body>

</html>
